# Ubuntu Development Environment - Copilot Instructions

> **Reusable Template**: This project includes a general-purpose Copilot workspace template at `./copilot-workspace-template/` that can be used for other projects. The instructions below are **Ubuntu development environment specific**.

When working with Ubuntu development environment setup scripts, follow these specialized guidelines:

## Ubuntu Environment Standards

### Bash Script Requirements (Ubuntu-Specific)

- Use `#!/usr/bin/env bash` with `set -euo pipefail` for Ubuntu compatibility
- Source utility scripts: `source "${SCRIPT_DIR}/util-*.sh"`
- Implement Ubuntu version detection: `get_ubuntu_version()` from `util-env.sh`
- Handle both snap and apt package management
- Support Ubuntu Desktop vs Server configurations

## Environment Detection Patterns (Ubuntu-Specific)

```bash
# Ubuntu-specific environment detection patterns from util-env.sh
source "${SCRIPT_DIR}/util-env.sh"

# Use existing utility functions
ENV_TYPE=$(detect_environment)  # Returns: WSL2, DESKTOP, HEADLESS
UBUNTU_VERSION=$(get_ubuntu_version)  # Returns: 20.04, 22.04, 24.04, etc.
WSL_VERSION=$(get_wsl_version)  # Returns: 0, 1, 2

# Environment-specific logic
case "$ENV_TYPE" in
  "WSL2")
    setup_wsl_integration
    ;;
  "DESKTOP")
    setup_desktop_environment
    ;;
  "HEADLESS")
    setup_headless_environment
    ;;
esac
```

## Ubuntu Package Management

### Multi-Package Manager Support

- **Primary**: Use `apt` for system packages and libraries
- **Applications**: Prefer `snap install --classic` for development tools
- **Fallback**: Support manual installation when packages unavailable
- **Validation**: Always check if package/command already exists before installing

### Installation Patterns

```bash
# Ubuntu-specific installation pattern
install_ubuntu_package() {
  local package="$1"
  local snap_name="${2:-$package}"
  
  # Check if already installed
  if command -v "$package" >/dev/null 2>&1; then
    log_info "$package already available"
    return 0
  fi
  
  # Try snap first for development tools
  if snap list "$snap_name" >/dev/null 2>&1; then
    log_info "$snap_name already installed via snap"
    return 0
  fi
  
  # Install via snap if available
  if snap info "$snap_name" >/dev/null 2>&1; then
    sudo snap install "$snap_name" --classic 2>/dev/null || sudo snap install "$snap_name"
    return $?
  fi
  
  # Fall back to apt
  sudo apt update && sudo apt install -y "$package"
}
```

## Error Handling Requirements

- Use meaningful exit codes (0=success, 1-255=errors)
- Provide contextual error messages with suggested solutions
- Implement cleanup with `trap` for temporary resources
- Validate dependencies before execution

## WSL2-Specific Considerations

- Use `/mnt/c/...` paths for Windows file access
- Configure Windows VS Code integration via `/mnt/c/Program Files/Microsoft VS Code/bin/code.cmd`
- Handle systemd availability gracefully
- Optimize wsl.conf and .wslconfig settings

## Security Best Practices

- Validate and sanitize all inputs
- Use absolute paths or proper validation
- Minimize sudo usage; prefer user-level operations
- Implement timeout mechanisms for network operations
- Never hardcode credentials or sensitive information

## Documentation Standards

- Include comprehensive header with usage examples
- Document all functions with parameters and return values
- Add troubleshooting sections for common issues
- Provide inline comments for complex logic

## Testing Requirements

- Scripts must be idempotent (safe to run multiple times)
- Test in both WSL2 and native Ubuntu environments
- Include error condition testing
- Verify cleanup on script termination

Follow these guidelines consistently across all generated bash scripts and configurations.
